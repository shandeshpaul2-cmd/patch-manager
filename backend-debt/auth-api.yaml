openapi: 3.0.3
info:
  title: InventIQ API Contract Debt
  description: |
    This file tracks all API contracts that need to be implemented by the backend team.
    Each endpoint defined here should be implemented exactly as specified to ensure
    seamless integration with the frontend.
  version: 1.0.0
  contact:
    name: API Support
    email: api@inventiq.com

servers:
  - url: https://api.inventiq.com/v1
    description: Production server
  - url: https://staging-api.inventiq.com/v1
    description: Staging server
  - url: http://localhost:3000/v1
    description: Local development server

tags:
  - name: Authentication
    description: User authentication and authorization endpoints
  - name: User
    description: User management endpoints

paths:
  /auth/login:
    post:
      tags:
        - Authentication
      summary: User login
      description: Authenticates a user with email and password
      operationId: loginUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: sharma@mail.com
                password:
                  type: string
                  format: password
                  example: password123
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
                      accessToken:
                        type: string
                        example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                      refreshToken:
                        type: string
                        example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                  message:
                    type: string
                    example: Login successful
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                success: false
                error:
                  code: INVALID_CREDENTIALS
                  message: Invalid email or password
        '422':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /auth/forgot-password:
    post:
      tags:
        - Authentication
      summary: Request password reset
      description: Sends a password reset link to the user's email
      operationId: forgotPassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  example: sharma@mail.com
      responses:
        '200':
          description: Password reset email sent
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Password reset link sent to your email
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /auth/reset-password:
    post:
      tags:
        - Authentication
      summary: Reset password
      description: Resets user password using a reset token
      operationId: resetPassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
                - password
                - confirmPassword
              properties:
                token:
                  type: string
                  example: abc123xyz789
                password:
                  type: string
                  format: password
                  example: newPassword123
                confirmPassword:
                  type: string
                  format: password
                  example: newPassword123
      responses:
        '200':
          description: Password reset successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Password reset successful
        '400':
          description: Invalid or expired token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /auth/logout:
    post:
      tags:
        - Authentication
      summary: User logout
      description: Invalidates the user's session and tokens
      operationId: logoutUser
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Logout successful
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /auth/refresh:
    post:
      tags:
        - Authentication
      summary: Refresh access token
      description: Gets a new access token using a refresh token
      operationId: refreshToken
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - refreshToken
              properties:
                refreshToken:
                  type: string
                  example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      accessToken:
                        type: string
                        example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        '401':
          description: Invalid refresh token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /user/me:
    get:
      tags:
        - User
      summary: Get current user
      description: Retrieves the authenticated user's profile
      operationId: getCurrentUser
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User profile retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /user/onboarding:
    post:
      tags:
        - User
      summary: Complete user onboarding
      description: |
        Completes the user onboarding process by collecting essential user information.
        This endpoint is called after initial account creation or invitation to set up
        the user's profile with their name, contact number, and password.
      operationId: completeOnboarding
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - contactNumber
                - password
                - confirmPassword
              properties:
                name:
                  type: string
                  minLength: 2
                  example: Sharma Patel
                  description: User's full name
                contactNumber:
                  type: string
                  pattern: '^\+[0-9]{1,3}[0-9]{10}$'
                  example: '+919876543210'
                  description: User's contact number with country code
                password:
                  type: string
                  format: password
                  minLength: 8
                  example: SecurePass123
                  description: User's password (minimum 8 characters)
                confirmPassword:
                  type: string
                  format: password
                  example: SecurePass123
                  description: Password confirmation (must match password)
      responses:
        '200':
          description: Onboarding completed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
                      accessToken:
                        type: string
                        example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                        description: JWT access token for authentication
                      refreshToken:
                        type: string
                        example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                        description: JWT refresh token for token renewal
                  message:
                    type: string
                    example: Onboarding completed successfully
        '400':
          description: Bad request - validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                passwordMismatch:
                  value:
                    success: false
                    error:
                      code: PASSWORD_MISMATCH
                      message: Password and confirm password do not match
                weakPassword:
                  value:
                    success: false
                    error:
                      code: WEAK_PASSWORD
                      message: Password must be at least 8 characters long
                invalidContactNumber:
                  value:
                    success: false
                    error:
                      code: INVALID_CONTACT_NUMBER
                      message: Please provide a valid contact number with country code
        '422':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                success: false
                error:
                  code: VALIDATION_ERROR
                  message: Validation failed
                  details:
                    - field: name
                      message: Name must be at least 2 characters long
                    - field: contactNumber
                      message: Contact number must include country code

components:
  schemas:
    User:
      type: object
      properties:
        id:
          type: string
          example: usr_123456789
        email:
          type: string
          format: email
          example: sharma@mail.com
        firstName:
          type: string
          example: Sharma
        lastName:
          type: string
          example: Patel
        role:
          type: string
          enum: [admin, user, manager]
          example: user
        avatar:
          type: string
          format: uri
          example: https://api.inventiq.com/avatars/usr_123456789.jpg
        createdAt:
          type: string
          format: date-time
          example: 2024-01-15T10:30:00Z
        updatedAt:
          type: string
          format: date-time
          example: 2024-01-20T14:45:00Z

    Error:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: object
          properties:
            code:
              type: string
              example: VALIDATION_ERROR
            message:
              type: string
              example: Validation failed
            details:
              type: array
              items:
                type: object
                properties:
                  field:
                    type: string
                    example: email
                  message:
                    type: string
                    example: Invalid email format

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtained from login endpoint
