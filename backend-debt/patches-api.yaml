openapi: 3.0.0
info:
  title: Patchify Patches API
  description: API specification for patch management system including patches, deployments, tests, and zero-touch configurations
  version: 1.0.0
  contact:
    name: Patchify Team

servers:
  - url: http://localhost:3000/api
    description: Local development server
  - url: https://api.patchify.com/api
    description: Production server

tags:
  - name: Patches
    description: Patch management operations
  - name: Deployments
    description: Patch deployment operations
  - name: Patch Tests
    description: Patch testing and approval
  - name: Zero Touch
    description: Zero-touch deployment configurations

paths:
  # ========================================
  # PATCHES ENDPOINTS
  # ========================================
  /patches:
    get:
      summary: Get all patches
      tags: [Patches]
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
        - in: query
          name: severity
          schema:
            type: string
            enum: [CRITICAL, High, Medium, Low, UNSPECIFIED]
        - in: query
          name: os
          schema:
            type: string
            enum: [Windows, MacOS, Ubuntu, Linux]
        - in: query
          name: search
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Patch'
        '500':
          $ref: '#/components/responses/InternalError'

    post:
      summary: Create a new patch
      tags: [Patches]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PatchInput'
      responses:
        '201':
          description: Patch created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Patch'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalError'

  /patches/{id}:
    get:
      summary: Get patch by ID
      tags: [Patches]
      parameters:
        - $ref: '#/components/parameters/PatchId'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Patch'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      summary: Update a patch
      tags: [Patches]
      parameters:
        - $ref: '#/components/parameters/PatchId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PatchInput'
      responses:
        '200':
          description: Patch updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Patch'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      summary: Delete a patch
      tags: [Patches]
      parameters:
        - $ref: '#/components/parameters/PatchId'
      responses:
        '204':
          description: Patch deleted successfully
        '404':
          $ref: '#/components/responses/NotFound'

  /patches/{id}/affected-products:
    get:
      summary: Get affected products for a patch
      tags: [Patches]
      parameters:
        - $ref: '#/components/parameters/PatchId'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AffectedProduct'

  /patches/{id}/scan-endpoints:
    post:
      summary: Initiate endpoint scan for patch
      tags: [Patches]
      parameters:
        - $ref: '#/components/parameters/PatchId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                scope:
                  type: string
                  enum: [All End Points, Specific Groups, Custom]
                endpointIds:
                  type: array
                  items:
                    type: string
      responses:
        '202':
          description: Scan initiated successfully

  /patches/{id}/file-details:
    get:
      summary: Get file details for a patch
      tags: [Patches]
      parameters:
        - $ref: '#/components/parameters/PatchId'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FileDetail'

  /patches/{id}/vulnerabilities:
    get:
      summary: Get vulnerabilities addressed by patch
      tags: [Patches]
      parameters:
        - $ref: '#/components/parameters/PatchId'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Vulnerability'

  /patches/{id}/endpoints:
    get:
      summary: Get endpoints affected by patch
      tags: [Patches]
      parameters:
        - $ref: '#/components/parameters/PatchId'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Endpoint'

  # ========================================
  # DEPLOYMENTS ENDPOINTS
  # ========================================
  /deployments:
    get:
      summary: Get all deployments
      tags: [Deployments]
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Deployment'

    post:
      summary: Create a new deployment
      tags: [Deployments]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeploymentInput'
      responses:
        '201':
          description: Deployment created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Deployment'

  /deployments/{id}:
    get:
      summary: Get deployment by ID
      tags: [Deployments]
      parameters:
        - $ref: '#/components/parameters/DeploymentId'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Deployment'

    delete:
      summary: Delete a deployment
      tags: [Deployments]
      parameters:
        - $ref: '#/components/parameters/DeploymentId'
      responses:
        '204':
          description: Deployment deleted successfully

  /deployments/{id}/preview:
    get:
      summary: Preview deployment details
      tags: [Deployments]
      parameters:
        - $ref: '#/components/parameters/DeploymentId'
      responses:
        '200':
          description: Deployment preview
          content:
            application/json:
              schema:
                type: object

  /deployments/{id}/execute:
    post:
      summary: Execute a deployment
      tags: [Deployments]
      parameters:
        - $ref: '#/components/parameters/DeploymentId'
      responses:
        '202':
          description: Deployment execution initiated

  # ========================================
  # PATCH TESTS ENDPOINTS
  # ========================================
  /patch-tests:
    get:
      summary: Get all patch tests
      tags: [Patch Tests]
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PatchTest'

    post:
      summary: Create a new patch test
      tags: [Patch Tests]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PatchTestInput'
      responses:
        '201':
          description: Test created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PatchTest'

  /patch-tests/{id}:
    get:
      summary: Get patch test by ID
      tags: [Patch Tests]
      parameters:
        - $ref: '#/components/parameters/TestId'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PatchTest'

    delete:
      summary: Delete a patch test
      tags: [Patch Tests]
      parameters:
        - $ref: '#/components/parameters/TestId'
      responses:
        '204':
          description: Test deleted successfully

  /patch-tests/{id}/approve:
    put:
      summary: Approve a patch test
      tags: [Patch Tests]
      parameters:
        - $ref: '#/components/parameters/TestId'
      responses:
        '200':
          description: Test approved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PatchTest'

  # ========================================
  # ZERO TOUCH ENDPOINTS
  # ========================================
  /zero-touch-configs:
    get:
      summary: Get all zero-touch configurations
      tags: [Zero Touch]
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ZeroTouchConfig'

    post:
      summary: Create a new zero-touch configuration
      tags: [Zero Touch]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ZeroTouchConfigInput'
      responses:
        '201':
          description: Configuration created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ZeroTouchConfig'

  /zero-touch-configs/{id}:
    get:
      summary: Get zero-touch configuration by ID
      tags: [Zero Touch]
      parameters:
        - $ref: '#/components/parameters/ConfigId'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ZeroTouchConfig'

    put:
      summary: Update a zero-touch configuration
      tags: [Zero Touch]
      parameters:
        - $ref: '#/components/parameters/ConfigId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ZeroTouchConfigInput'
      responses:
        '200':
          description: Configuration updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ZeroTouchConfig'

    delete:
      summary: Delete a zero-touch configuration
      tags: [Zero Touch]
      parameters:
        - $ref: '#/components/parameters/ConfigId'
      responses:
        '204':
          description: Configuration deleted successfully

# ========================================
# COMPONENTS
# ========================================
components:
  parameters:
    PatchId:
      name: id
      in: path
      required: true
      schema:
        type: string
    DeploymentId:
      name: id
      in: path
      required: true
      schema:
        type: string
    TestId:
      name: id
      in: path
      required: true
      schema:
        type: string
    ConfigId:
      name: id
      in: path
      required: true
      schema:
        type: string

  schemas:
    Patch:
      type: object
      required: [id, software, patchId, severity, os]
      properties:
        id:
          type: string
        software:
          type: string
        patchId:
          type: string
        endpoints:
          type: integer
        os:
          type: string
          enum: [Windows, MacOS, Ubuntu, Linux]
        severity:
          type: string
          enum: [CRITICAL, High, Medium, Low, UNSPECIFIED]
        operationalStatusSince:
          type: string
        platform:
          type: string
        description:
          type: string
        category:
          type: string
        bulletinId:
          type: string
        kbNumber:
          type: string
        releaseDate:
          type: string
          format: date
        rebootRequired:
          type: boolean
        supportUninstallation:
          type: boolean
        architecture:
          type: string
        referenceUrl:
          type: string
          format: uri
        languagesSupported:
          type: array
          items:
            type: string
        tags:
          type: array
          items:
            type: string
        approvalStatus:
          type: string
        testStatus:
          type: string
        cveNumbers:
          type: array
          items:
            type: string

    PatchInput:
      type: object
      required: [software, platform, severity, category, bulletinId, kbNumber, releaseDate, architecture, referenceUrl]
      properties:
        software:
          type: string
        platform:
          type: string
        description:
          type: string
        category:
          type: string
        severity:
          type: string
        bulletinId:
          type: string
        kbNumber:
          type: string
        releaseDate:
          type: string
        rebootRequired:
          type: boolean
        supportUninstallation:
          type: boolean
        architecture:
          type: string
        referenceUrl:
          type: string
        languagesSupported:
          type: array
          items:
            type: string
        tags:
          type: array
          items:
            type: string

    Deployment:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        deploymentId:
          type: string
        type:
          type: string
          enum: [INSTALL, ROLLBACK]
        stage:
          type: string
          enum: [INSTALLED, COMPLETED, IN_PROGRESS, FAILED]
        pending:
          type: integer
        succeeded:
          type: integer
        failed:
          type: integer
        createdBy:
          type: string
        createdOn:
          type: string
          format: date-time

    DeploymentInput:
      type: object
      required: [name, description, type, schedule, targetGroups, patches]
      properties:
        name:
          type: string
        description:
          type: string
        type:
          type: string
          enum: [INSTALL, ROLLBACK]
        schedule:
          type: string
          format: date-time
        targetGroups:
          type: array
          items:
            type: string
        patches:
          type: array
          items:
            type: string

    PatchTest:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
        applicationType:
          type: string
          enum: [ALL, INCLUDE, EXCLUDE]
        applications:
          type: array
          items:
            type: string
        scope:
          type: string
          enum: [ALL_COMPUTERS, SCOPE, SPECIFIC_GROUPS]
        computers:
          type: array
          items:
            type: string
        groups:
          type: array
          items:
            type: string
        status:
          type: string
        createdBy:
          type: string
        createdOn:
          type: string

    PatchTestInput:
      type: object
      required: [name, description, applicationType, scope]
      properties:
        name:
          type: string
        description:
          type: string
        applicationType:
          type: string
        applications:
          type: array
          items:
            type: string
        scope:
          type: string
        computers:
          type: array
          items:
            type: string
        groups:
          type: array
          items:
            type: string

    ZeroTouchConfig:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
        applicationType:
          type: string
        applications:
          type: array
          items:
            type: string
        scope:
          type: string
        computers:
          type: array
          items:
            type: string
        groups:
          type: array
          items:
            type: string
        autoDeploymentRules:
          type: object
          properties:
            severity:
              type: array
              items:
                type: string
            approvalRequired:
              type: boolean
            schedule:
              type: string
        status:
          type: string
        createdBy:
          type: string
        createdOn:
          type: string

    ZeroTouchConfigInput:
      type: object
      required: [name, description, applicationType, scope, autoDeploymentRules]
      properties:
        name:
          type: string
        description:
          type: string
        applicationType:
          type: string
        applications:
          type: array
          items:
            type: string
        scope:
          type: string
        computers:
          type: array
          items:
            type: string
        groups:
          type: array
          items:
            type: string
        autoDeploymentRules:
          type: object
          required: [severity, schedule]
          properties:
            severity:
              type: array
              items:
                type: string
            approvalRequired:
              type: boolean
            schedule:
              type: string

    AffectedProduct:
      type: object
      properties:
        id:
          type: string
        hostName:
          type: string
        location:
          type: string
        vendor:
          type: string
        hardwareModel:
          type: string

    FileDetail:
      type: object
      properties:
        id:
          type: string
        fileName:
          type: string
        version:
          type: string
        size:
          type: string
        path:
          type: string

    Vulnerability:
      type: object
      properties:
        id:
          type: string
        cveNumber:
          type: string
        severity:
          type: string
        description:
          type: string
        publishedDate:
          type: string

    Endpoint:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        os:
          type: string
        status:
          type: string
        lastSeen:
          type: string

    Error:
      type: object
      properties:
        code:
          type: string
        message:
          type: string
        details:
          type: object

  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    InternalError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
